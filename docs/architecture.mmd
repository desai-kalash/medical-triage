flowchart LR
%% --- High-contrast, bigger text; all labels quoted ---
classDef node   fill:#3b82f6,color:#ffffff,stroke:#1e40af,stroke-width:1.5px,font-size:16px;
classDef accent fill:#10b981,color:#ffffff,stroke:#065f46,stroke-width:1.5px,font-size:16px;
classDef ext    fill:#f59e0b,color:#111111,stroke:#b45309,stroke-width:1.5px,font-size:16px;
classDef log    fill:#e5e7eb,color:#111111,stroke:#6b7280,stroke-width:1.5px,font-size:16px;

U["User"]:::node -->|HTTPS| B["Browser UI<br/>index.html / intake.html"]:::node
B -->|HTTP| H["Akka HTTP Server<br/>(Primary Node 2551)"]:::node

subgraph C["Akka Cluster (Typed)"]
direction LR

  subgraph P["Primary Node :2551"]
  direction TB
    H --> UIA["UserInputActor"]:::accent
    UIA --> TRA["TriageRouterActor"]:::accent
    TRA --> USA["UserSessionActor<br/>(session memory)"]:::node
    TRA --> RET["RetrievalActor"]:::node
    TRA --> LLM["LLMActor<br/>(Gemini 1.5 Flash)"]:::accent
    TRA --> CARE["EmergencyCareActor<br/>SelfCareActor<br/>AppointmentActor"]:::node
    PLOG["LoggerActor"]:::log
    UIA --> PLOG
    TRA --> PLOG
  end

  subgraph S["Service Node :2552"]
  direction TB
    SRET["RetrievalActor"]:::node
    SLLM["LLMActor"]:::accent
    SCARE["Care Actors"]:::node
    SLOG["LoggerActor"]:::log
  end

  RET <-->|work sharing| SRET
  LLM <-->|backpressure| SLLM
  CARE <-->|failover| SCARE
  PLOG -. audit .- SLOG
end

subgraph K["Knowledge Layer"]
direction TB
  VS["Lucene HNSW<br/>Vector Index"]:::node
  CORPUS["Curated Medical Corpus<br/>(JSONL)"]:::node
end
RET -->|ANN search| VS
VS --> CORPUS

subgraph EXT["Authoritative Medical Sources"]
direction TB
  NHS["NHS"]:::ext
  MAYO["Mayo Clinic"]:::ext
  MEDLINE["MedlinePlus"]:::ext
end
RET -->|live fetch<br/>on low similarity| NHS
RET --> MAYO
RET --> MEDLINE

LLM -->|prompt + context| TRA
TRA -->|final assessment<br/>+ urgency| B
